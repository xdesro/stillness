---
layout: base.html
---

<main>
  <button id="getgeo" style="top: 0;left:0">test</button>
  <form id="form">
    <textarea name="body"></textarea>
    <button type="submit">submit</button>
  </form>
</main>

<script>
  const form = document.querySelector("#form");
  const button = document.querySelector('#getgeo')
  let currentLocation = null;

  const success = (position) => {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;

    button.textContent = `${latitude} - ${longitude}`;
    return [latitude, longitude];
  };

  button.addEventListener("click", (e) => {
    if (navigator.location) {
      currentLocation = navigator.geolocation.getCurrentPosition(success);
    } else {
      console.log('no nav')
    }
  });
  const handleSubmission = (e) => {
    e.preventDefault();

    const text = e.target.elements.body.value;
    const date = new Date();

    const template = `---
date: ${date.toISOString()}
---
${text}`;

    const message = `ðŸ“„ - Create new post: ${date}`;
    const ghQueryUrl = `https://github.com/xdesro/stillness/new/main/posts?filename=${date}.html&value=${encodeURIComponent(
      template
    )}&message=${encodeURIComponent(message)}`;
    window.location.href = ghQueryUrl;
  };

  form.addEventListener("submit", handleSubmission);
</script>
